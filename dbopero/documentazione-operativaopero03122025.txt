

â— DOCUMENTO OPERATIVO PROGETTO OPERO

  Guida completa per il team di sviluppo

  ---
  SINTESI ESECUTIVA

  OpÃ¨ro Ã¨ un sistema ERP enterprise-grade basato su architettura web moderna con stack Node.js + Express (backend) e React.js (frontend), supportato da database MySQL. Il sistema implementa multi-tenancy
   avanzato, contabilitÃ  integrata, gestione magazzino, vendite, acquisti e beni strumentali.

  Caratteristiche Principali

  - Multi-ditta: Supporto illimitato aziende con isolamento dati completo
  - Sicurezza robusta: JWT + permission-based authorization granulare
  - Mobile-ready: Capacitor per app native iOS/Android
  - Scalabile: Architettura modulare con lazy loading
  - Enterprise: 87+ endpoint API distribuiti in 10 moduli business

  ---
  1. ARCHITETTURA DEL SISTEMA

  1.1 Stack Tecnologico

  Backend

  Node.js + Express.js
  â”œâ”€â”€ MySQL2 + Knex.js (ORM)
  â”œâ”€â”€ JWT Authentication
  â”œâ”€â”€ BCrypt (password hashing)
  â”œâ”€â”€ Mailparser (email processing)
  â”œâ”€â”€ Puppeteer (PDF generation)
  â”œâ”€â”€ AWS SDK (cloud services)
  â””â”€â”€ Multiparty (file uploads)

  Frontend

  React.js + Capacitor
  â”œâ”€â”€ Axios (HTTP client)
  â”œâ”€â”€ Ag-Grid (tabelle avanzate)
  â”œâ”€â”€ ReactQuill (editor testi)
  â”œâ”€â”€ Lazy loading (performance)
  â””â”€â”€ Responsive design

  1.2 Struttura Directory

  opero/
  â”œâ”€â”€ server.js                 # Server Express principale
  â”œâ”€â”€ package.json              # Dipendenze backend
  â”œâ”€â”€ knexfile.js              # Configurazione database
  â”œâ”€â”€ config/db.js             # Pool connessioni
  â”œâ”€â”€ routes/                  # API routes
  â”‚   â”œâ”€â”€ auth.js             # Autenticazione
  â”‚   â”œâ”€â”€ admin.js            # Amministrazione sistema
  â”‚   â”œâ”€â”€ anagrafica.js       # Anagrafiche
  â”‚   â”œâ”€â”€ catalogo.js         # Catalogo prodotti
  â”‚   â”œâ”€â”€ magazzino.js        # Gestione magazzino
  â”‚   â”œâ”€â”€ vendite.js          # Modulo vendite
  â”‚   â”œâ”€â”€ acquisti.js         # Gestione acquisti
  â”‚   â”œâ”€â”€ documenti.js        # Gestione documentale
  â”‚   â”œâ”€â”€ amministrazione.js  # ContabilitÃ 
  â”‚   â”œâ”€â”€ mail.js             # Email system
  â”‚   â””â”€â”€ [altri moduli...]
  â”œâ”€â”€ migrations/              # Schema database
  â”œâ”€â”€ opero-frontend/          # App React
  â”‚   â”œâ”€â”€ src/
  â”‚   â”‚   â”œâ”€â”€ components/     # Componenti principali
  â”‚   â”‚   â”œâ”€â”€ context/        # Auth context
  â”‚   â”‚   â”œâ”€â”€ services/       # API services
  â”‚   â”‚   â””â”€â”€ lib/           # Utilities
  â”‚   â””â”€â”€ package.json       # Dipendenze frontend
  â””â”€â”€ uploads/                # File storage

  ---
  2. DATABASE SCHEMA

  2.1 Tabelle Principali

  Multi-tenancy e Sistema

  ditte                                    -- Aziende (multi-tenant)
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ ragione_sociale
  â”œâ”€â”€ partita_iva (UNIQUE)
  â”œâ”€â”€ codice_fiscale
  â””â”€â”€ [campi anagrafici]

  utenti                                    -- Utenti sistema
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ id_ruolo (FK â†’ ruoli.id)
  â”œâ”€â”€ email (UNIQUE)
  â”œâ”€â”€ password
  â””â”€â”€ [dati anagrafici]

  ad_utenti_ditte                          -- Associazioni utenti-ditte
  â”œâ”€â”€ id_utente (PK, FK â†’ utenti.id)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â””â”€â”€ livello (access level 1-100)

  ContabilitÃ 

  sc_piano_dei_conti                       -- Piano dei conti
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ codice_conto
  â”œâ”€â”€ descrizione
  â””â”€â”€ tipo_conto (enum)

  conti                                    -- Conti principali
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ codice
  â”œâ”€â”€ descrizione
  â””â”€â”€ tipo (enum)

  sottoconti                               -- Sottoconti
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ id_conto (FK â†’ conti.id)
  â”œâ”€â”€ codice_sottoconto
  â””â”€â”€ descrizione

  prima_nota                               -- Registrazioni contabili
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ data_registrazione
  â”œâ”€â”€ descrizione
  â”œâ”€â”€ id_utente (FK â†’ utenti.id)
  â””â”€â”€ anno (FK â†’ anno_di_gestione.anno)

  registrazioni_prima_nota                 -- Righe registrazioni
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_prima_nota (FK â†’ prima_nota.id)
  â”œâ”€â”€ id_conto (FK â†’ conti.id)
  â”œâ”€â”€ importo_dare (decimal(12,2))
  â”œâ”€â”€ importo_avere (decimal(12,2))
  â””â”€â”€ descrizione_riga

  Catalogo e Magazzino

  ct_catalogo                             -- Catalogo articoli
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ codice_entita (UNIQUE + id_ditta)
  â”œâ”€â”€ descrizione
  â”œâ”€â”€ id_categoria (FK â†’ ct_categorie.id)
  â”œâ”€â”€ tipo_entita (enum: bene/servizio/composito)
  â”œâ”€â”€ id_unita_misura (FK â†’ ct_unita_misura.id)
  â”œâ”€â”€ id_aliquota_iva (FK â†’ iva_contabili.id)
  â”œâ”€â”€ prezzo_base (decimal(10,2))
  â””â”€â”€ gestito_a_magazzino (boolean)

  mg_magazzini                            -- Magazzini fisici
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ codice (UNIQUE + id_ditta)
  â”œâ”€â”€ descrizione
  â””â”€â”€ note

  mg_movimenti                            -- Movimenti magazzino
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ id_magazzino (FK â†’ mg_magazzini.id)
  â”œâ”€â”€ id_catalogo (FK â†’ ct_catalogo.id)
  â”œâ”€â”€ id_causale (FK â†’ mg_causali_movimento.id)
  â”œâ”€â”€ id_utente (FK â†’ utenti.id)
  â”œâ”€â”€ data_movimento (timestamp)
  â”œâ”€â”€ quantita (decimal(12,4))
  â”œâ”€â”€ valore_unitario (decimal(12,4))
  â”œâ”€â”€ riferimento_doc
  â””â”€â”€ note

  Vendite

  va_clienti_anagrafica                   -- Clienti
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta_anagrafica (FK â†’ ditte.id)
  â”œâ”€â”€ id_matrice_sconti (FK â†’ va_matrice_sconti.id)
  â””â”€â”€ id_punto_consegna_predefinito

  va_matrice_sconti                       -- Matrici sconti clienti
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ codice (UNIQUE + id_ditta)
  â”œâ”€â”€ descrizione

  va_matrice_sconti_righe                 -- Righe matrice sconti
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_matrice_sconti (FK â†’ va_matrice_sconti.id)
  â”œâ”€â”€ id_catalogo (FK â†’ ct_catalogo.id)
  â”œâ”€â”€ sconto_percentuale (decimal(5,2))
  â”œâ”€â”€ sconto_importo (decimal(10,2))
  â””â”€â”€ quantita_minima (decimal(12,4))

  Email e Comunicazione

  ditta_mail_accounts                     -- Account email aziendali
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ email_address
  â”œâ”€â”€ smtp_host, smtp_port, smtp_user, smtp_password
  â”œâ”€â”€ imap_host, imap_port, imap_user, imap_password
  â””â”€â”€ is_default (boolean)

  emails_inviate                         -- Email inviate tracciate
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_ditta (FK â†’ ditte.id)
  â”œâ”€â”€ id_utente (FK â†’ utenti.id)
  â”œâ”€â”€ id_mail_account (FK â†’ ditta_mail_accounts.id)
  â”œâ”€â”€ destinatario
  â”œâ”€â”€ oggetto, corpo
  â”œâ”€â”€ data_invio (timestamp)
  â”œâ”€â”€ stato (enum: Inviata/Fallita/Tracciata)
  â””â”€â”€ message_id

  allegati_tracciati                     -- Tracking allegati
  â”œâ”€â”€ id (PK, auto_increment)
  â”œâ”€â”€ id_email_inviata (FK â†’ emails_inviate.id)
  â”œâ”€â”€ nome_file_originale
  â”œâ”€â”€ percorso_file_salvato
  â”œâ”€â”€ download_id (UNIQUE)
  â”œâ”€â”€ scaricato (boolean)
  â””â”€â”€ data_primo_download (timestamp)

  2.2 Schema Relazionale Completo

  Il database implementa una struttura multi-tenant dove tutte le tabelle business hanno id_ditta come chiave esterna verso ditte.id, garantendo isolamento completo dati tra aziende.

  Relazioni Principali:
  - ditte â†’ Tutte le tabelle (multi-tenancy)
  - utenti â†’ ruoli (sistema permessi)
  - sc_piano_dei_conti â†’ conti â†’ sottoconti (gerarchia contabile)
  - ct_catalogo â†’ mg_movimenti (magazzino)
  - va_matrice_sconti â†’ ct_catalogo (prezzi clienti)
  - ditta_mail_accounts â†’ emails_inviate â†’ allegati_tracciati (email system)

  ---
  3. API ENDPOINTS

  3.1 Autenticazione e Sicurezza

  /auth - Autenticazione Utenti

  POST /auth/login                          // Login utente
    â†’ { email, password }
    â† { token, user, permissions }

  POST /auth/logout                         // Logout
    â†’ headers: Authorization: Bearer <token>

  GET  /auth/me                            // Dati utente corrente
    â†’ headers: Authorization
    â† { id, nome, email, ruolo, ditta_corrente, permissions }

  GET  /auth/funzioni-scorciatoie          // Scorciatoie personalizzate
    â†’ headers: Authorization
    â† [{ nome, percorso, icona }]

  GET  /auth/heartbeat                     // Keep-alive sessione
    â†’ headers: Authorization
    â† { timestamp, expires_in }

  /admin - Amministrazione Sistema

  GET  /admin/utenti/ditta/{id_ditta}      // Utenti per ditta
  POST /admin/utenti                       // Nuovo utente
  PUT  /admin/utenti/{id}                  // Aggiorna utente
  DELETE /admin/utenti/{id}               // Elimina utente

  GET  /admin/ruoli                        // Ruoli sistema
  POST /admin/ruoli                        // Nuovo ruolo
  PUT  /admin/ruoli/{id}                   // Aggiorna ruolo

  GET  /admin/ditte                        // Aziende sistema
  POST /admin/ditte                        // Nuova azienda
  PUT  /admin/ditte/{id}                   // Aggiorna azienda

  GET  /admin/logs/azioni                  // Log attivitÃ 
  GET  /admin/logs/accessi                 // Log accessi
  GET  /admin/logs/sessioni-attive         // Sessioni attive

  GET  /admin/funzioni                     // Funzioni applicative
  POST /admin/associa-funzione             // Associa funzione utente

  3.2 Moduli Business

  /catalogo - Gestione Catalogo

  GET  /catalogo/articoli                  // Lista articoli
  POST /catalogo/articoli                  // Nuovo articolo
  PUT  /catalogo/articoli/{id}             // Aggiorna articolo
  DELETE /catalogo/articoli/{id}          // Elimina articolo

  GET  /catalogo/categorie                 // Categorie merceologiche
  POST /catalogo/categorie                 // Nuova categoria

  GET  /catalogo/listini                   // Listini prezzi
  POST /catalogo/listini                   // Nuovo listino
  PUT  /catalogo/listini/{id}              // Aggiorna listino

  GET  /catalogo/iva                       // Aliquote IVA
  POST /catalogo/iva                       // Nuova aliquota

  POST /catalogo/import                    // Importazione CSV
  POST /catalogo/foto                      // Upload foto articolo

  /magazzino - Gestione Magazzino

  GET  /magazzino/giacenze                 // Giacenze attuali
    â†’ ?id_magazzino=x&id_catalogo=y
    â† [{ articolo, magazzino, quantita, valore }]

  GET  /magazzino/movimenti                // Storico movimenti
  POST /magazzino/movimenti                // Nuovo movimento
  PUT  /magazzino/movimenti/{id}           // Aggiorna movimento

  GET  /magazzino/magazzini                // Magazzini configurati
  POST /magazzino/magazzini                // Nuovo magazzino

  GET  /magazzino/causali                  // Causali movimento
  POST /magazzino/causali                  // Nuova causale

  /vendite - Modulo Vendite

  GET  /vendite/clienti                    // Anagrafica clienti
  POST /vendite/clienti                    // Nuovo cliente
  PUT  /vendite/clienti/{id}               // Aggiorna cliente

  GET  /vendite/tabelle                    // Tabelle prezzi clienti
  POST /vendite/tabelle                    // Nuova tabella prezzi

  GET  /vendite/contratti                  // Contratti clienti
  POST /vendite/contratti                  // Nuovo contratto

  GET  /vendite/liste                      // Liste articoli per clienti
  POST /vendite/liste                      // Nuova lista

  /amministrazione - ContabilitÃ 

  GET  /amministrazione/dashboard          // Dashboard contabile
  GET  /amministrazione/report/bilancio    // Report bilancio
  GET  /amministrazione/report/iva         // Report IVA

  GET  /amministrazione/piano-conti        // Piano dei conti
  POST /amministrazione/piano-conti        // Nuovo conto

  GET  /amministrazione/registrazioni      // Registrazioni prima nota
  POST /amministrazione/registrazioni      // Nuova registrazione
  PUT  /amministrazione/registrazioni/{id} // Aggiorna registrazione

  /mail - Sistema Email

  GET  /mail/my-mail-accounts              // Account email utente
  POST /mail/my-mail-accounts              // Nuovo account email

  GET  /mail/emails                        // Email in arrivo (IMAP)
  GET  /mail/emails/{uid}                  // Dettaglio email
  POST /mail/hide-email/{uid}              // Nascondi email

  POST /mail/send-email                    // Invia email
    â†’ { to, cc, bcc, subject, body, attachments[] }
    â† { status, message_id, tracking_links[] }

  GET  /mail/sent-emails                   // Email inviate tracciate
  GET  /mail/sent-emails/{id}/tracking     // Statistiche tracking

  GET  /mail/allegati/{download_id}        // Download allegato tracciato
  POST /mail/allegati/{download_id}/track  // Registra download

  3.3 Pattern Comuni API

  Autenticazione

  Tutte le API (tranne auth/login, auth/register, public) richiedono:
  headers: {
    'Authorization': 'Bearer <JWT_TOKEN>',
    'Content-Type': 'application/json'
  }

  Multi-Ditta

  Le API possono filtrare per ditta corrente o specifica:
  GET /endpoint?ditta=123                // Ditta specifica (solo admin sistema)
  GET /endpoint                          // Ditta corrente utente

  Pagination

  GET /endpoint?page=1&limit=50&sort=desc
  â† { data: [], total: 150, page: 1, limit: 50 }

  Error Handling

  Success (200-299):
  { success: true, data: {} }

  Error (4xx-5xx):
  { success: false, error: "message", code: "ERROR_CODE" }

  ---
  4. COMPONENTI FRONTEND

  4.1 Architettura Componenti

  MainApp.js - Application Hub

  // ResponsabilitÃ :
  - Routing principale
  - Gestione autenticazione
  - Dashboard con scorciatoie
  - Monitoraggio attivitÃ  PPA

  // API utilizzate:
  GET /auth/me                           // Dati utente
  GET /auth/funzioni-scorciatoie        // Scorciatoie
  GET /attivita/mie-future              // AttivitÃ  utente
  GET /system/modules                   // Moduli disponibili

  AdminPanel.js - Amministrazione Sistema

  // ResponsabilitÃ :
  - Gestione utenti e ruoli
  - Configurazione ditte
  - Monitoring logs e sessioni
  - Gestione funzioni applicative

  // API principali:
  GET/POST/PUT/DELETE /admin/utenti/*   // CRUD utenti
  GET/POST /admin/ruoli                 // Gestione ruoli
  GET/POST /admin/ditte                 // Gestione ditte
  GET /admin/logs/*                     // Log sistema

  Moduli Business

  CatalogoModule.js
  // FunzionalitÃ :
  - CRUD articoli
  - Import/export CSV
  - Gestione categorie, IVA, listini
  - Upload foto prodotti

  // API:
  GET/POST/PUT/DELETE /catalogo/articoli
  GET/POST /catalogo/categorie
  POST /catalogo/import
  POST /catalogo/foto

  MagazzinoModule.js
  // FunzionalitÃ :
  - Visualizzazione giacenze real-time
  - Movimentazione magazzino
  - Configurazione magazzini e causali
  - Report inventario

  // API:
  GET /magazzino/giacenze
  POST /magazzino/movimenti
  GET/POST /magazzino/magazzini

  VenditeModule.js
  // FunzionalitÃ :
  - Anagrafica clienti
  - Tabelle prezzi personalizzate
  - Gestione contratti
  - Liste articoli per clienti

  // API:
  GET/POST /vendite/clienti
  GET/POST /vendite/tabelle
  GET/POST /vendite/contratti

  MailModule.js
  // FunzionalitÃ :
  - Client email multi-account
  - Composizione email con tracking
  - Rubrica integrata
  - Download allegati tracciati

  // API:
  GET /mail/my-mail-accounts
  GET /mail/emails
  POST /mail/send-email
  GET /mail/allegati/{download_id}

  4.2 Sistema Permessi

  Livelli Accesso (1-100)

  Livello 1-29:   Utente base
  Livello 30-49:  Operatore avanzato
  Livello 50-79:  Manager
  Livello 80-89:  Amministratore Aziendale
  Livello 90-99:  Super Amministratore
  Livello 100:    System Administrator

  Permessi Funzionali

  CT_VIEW         // Visualizza catalogo
  CT_EDIT         // Modifica catalogo
  MG_GIACENZE_VIEW // Visualizza giacenze
  MG_MOVIMENTI_MANAGE // Gestione movimenti
  VA_CLIENTI_MANAGE // Gestione clienti
  MAIL_SEND       // Invio email
  PPA_VIEW_ALL    // Visualizza tutte attivitÃ 

  Controllo Accessi

  const hasPermission = (level, permission) => {
    return user.livello >= level &&
           user.permissions.includes(permission);
  }

  ---
  5. FLUSSI DI LAVORO PRINCIPALI

  5.1 Gestione Utenti Multi-Ditta

  1. System Admin crea nuova azienda via AdminPanel.js
  POST /admin/ditte
  â†’ { ragione_sociale, partita_iva, ... }
  2. System Admin crea utente e associa ditte
  POST /admin/utenti
  â†’ { nome, email, password, id_ruolo, ditte_associate[] }

  POST /admin/associa-utente-ditta
  â†’ { id_utente, id_ditta, livello_accesso }
  3. Utente fa login e seleziona ditta
  POST /auth/login
  â†’ { email, password, id_ditta_selezionata }

  5.2 Gestione Catalogo Articoli

  1. Inserimento Articolo via CatalogoModule.js
  POST /catalogo/articoli
  â†’ {
      codice_entita: "ART001",
      descrizione: "Prodotto Test",
      id_categoria: 1,
      tipo_entita: "bene",
      prezzo_base: 100.00,
      gestito_a_magazzino: true
  }
  2. Aggiornamento Giacenze via MagazzinoModule.js
  POST /magazzino/movimenti
  â†’ {
      id_magazzino: 1,
      id_catalogo: 123,
      id_causale: 1, // Carico
      quantita: 50,
      valore_unitario: 80.00
  }

  5.3 Email con Tracking

  1. Configurazione Account via MailModule.js
  POST /mail/my-mail-accounts
  â†’ {
      email_address: "info@azienda.it",
      smtp_host: "smtp.azienda.it",
      // ... altri parametri IMAP/SMTP
  }
  2. Invio Email con Allegati
  POST /mail/send-email
  â†’ {
      to: ["cliente@example.com"],
      subject: "Offerta commerciale",
      body: "<p>Allegata nostra offerta...</p>",
      attachments: [{
          filename: "offerta.pdf",
          path: "/uploads/offerta.pdf"
      }]
  }
  â† {
      message_id: "msg_123",
      tracking_links: [{
          type: "allegato",
          download_id: "dl_456",
          url: "https://app.opero.it/mail/allegati/dl_456"
      }]
  }
  3. Tracking Download Allegato
  // Cliente clicca link tracking
  GET /mail/allegati/dl_456
  // Sistema registra download e serve file

  POST /mail/allegati/dl_456/track
  â†’ { timestamp: "2025-01-15T10:30:00Z" }

  ---
  6. CONFIGURAZIONE AMBIENTE

  6.1 Variabili Environment (.env)

  # Database
  DB_HOST=localhost
  DB_PORT=3306
  DB_NAME=opero_db
  DB_USER=opero_user
  DB_PASSWORD=secure_password

  # JWT
  JWT_SECRET=your-super-secret-jwt-key
  JWT_EXPIRES_IN=24h

  # Email
  DEFAULT_SMTP_HOST=smtp.gmail.com
  DEFAULT_SMTP_PORT=587
  DEFAULT_SMTP_USER=your-email@gmail.com
  DEFAULT_SMTP_PASSWORD=your-app-password

  # File Upload
  UPLOAD_DIR=./uploads
  MAX_FILE_SIZE=50MB

  # AWS (opzionale)
  AWS_ACCESS_KEY_ID=your-aws-key
  AWS_SECRET_ACCESS_KEY=your-aws-secret
  AWS_S3_BUCKET=opero-documents

  6.2 Setup Sviluppo

  # Clone e installazione
  git clone <repository>
  cd opero
  npm install

  # Frontend
  cd opero-frontend
  npm install

  # Database
  npm run migrate          # Esegue migrazioni
  npm run seed            # Dati iniziali (opzionale)

  # Avvio sviluppo
  cd ..                  # Torna root
  npm run dev            # Backend (porta 3001)
  cd opero-frontend
  npm start              # Frontend (porta 3000)

  6.3 Setup Produzione

  # Build frontend
  cd opero-frontend
  npm run build

  # Backend produzione
  cd ..
  npm start              # Server.js con modalitÃ  produzione

  ---
  7. BEST PRACTICES E CONVENZIONI

  7.1 Database

  - Nomenclatura tabelle: prefisso_modulo_tabella (es: ct_catalogo, mg_movimenti)
  - Multi-tenancy: tutte le tabelle business hanno id_ditta
  - Timestamp: tutte le tabelle hanno created_at, updated_at
  - Soft delete: usare campo deleted_at invece di DELETE fisico

  7.2 API

  - RESTful: verbi HTTP appropriati (GET/POST/PUT/DELETE)
  - Response format: consistente { success: boolean, data|error: any }
  - Error handling: HTTP status codes appropriati con messaggi chiari
  - Pagination: ?page=1&limit=50&sort=desc

  7.3 Frontend

  - Component naming: PascalCase con estensione .js (es: CatalogoModule.js)
  - File structure: componenti raggruppati per modulo
  - State management: useContext per stato globale, useState per locale
  - API calls: centralizzate in services/ con axios

  7.4 Sicurezza

  - Password: hash con bcrypt, lunghezza minima 8 caratteri
  - JWT: scadenza 24h, refresh token opzionale
  - CORS: configurazione restrittiva in produzione
  - Input validation: sempre validare e sanitizzare input
  - SQL injection: usare sempre parameterized queries (Knex.js)

  ---
  8. TROUBLESHOOTING E DEBUG

  8.1 Problemi Comuni

  Database Connection

  // Verifica connessione database
  const knex = require('knex')(knexfile);
  knex.raw('SELECT 1')
    .then(() => console.log('DB OK'))
    .catch(err => console.error('DB Error:', err));

  Authentication Issues

  // Debug token JWT
  const jwt = require('jsonwebtoken');
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    console.log('Token valido:', decoded);
  } catch (err) {
    console.log('Token invalido:', err.message);
  }

  Frontend API Calls

  // Logging chiamate API
  axios.interceptors.request.use(req => {
    console.log('API Request:', req.method, req.url);
    return req;
  });

  axios.interceptors.response.use(
    res => {
      console.log('API Response:', res.status, res.data);
      return res;
    },
    err => {
      console.error('API Error:', err.response?.data || err.message);
      return Promise.reject(err);
    }
  );

  8.2 Performance Optimization

  Database Indexes

  -- Indici per performance
  CREATE INDEX idx_movimenti_data ON mg_movimenti(data_movimento);
  CREATE INDEX idx_utenti_ditta ON utenti(id_ditta);
  CREATE INDEX idx_email_inviata_data ON emails_inviate(data_invio);

  Frontend Lazy Loading

  // Lazy loading moduli
  const CatalogoModule = lazy(() => import('./components/CatalogoModule'));
  const MagazzinoModule = lazy(() => import('./components/MagazzinoModule'));

  // Usage with Suspense
  <Suspense fallback={<div>Loading...</div>}>
    <CatalogoModule />
  </Suspense>

  ---
  9. MONITORING E MANUTENZIONE

  9.1 Logging

  // Log attivitÃ  utente
  POST /admin/logs/azioni
  â†’ {
      id_utente: 123,
      azione: "CREATE_ARTICOLO",
      dettagli: "Creato articolo ART001",
      ip_address: "192.168.1.100",
      user_agent: "Mozilla/5.0..."
  }

  9.2 Health Check

  GET /system/health
  â† {
      status: "OK",
      timestamp: "2025-01-15T10:30:00Z",
      services: {
          database: "OK",
          email: "OK",
          storage: "OK"
      },
      uptime: "5 days, 3:42:15"
  }

  9.3 Backup Strategy

  - Database: Daily backup con retention 30 giorni
  - File uploads: Weekly backup su AWS S3

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
>Â 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ? for shortcuts


  1. Mobile App Native (Capacitor giÃ  configurato)
  2. Advanced Analytics con dashboard personalizzabili
  3. API Documentation automatica (Swagger/OpenAPI)
  4. Real-time Updates con WebSockets
  5. Advanced Reporting con Jasper Reports integration

  10.2 Technical Debt

  - Migrare da callback a async/await dove mancante
  - Implementare cache Redis per performance
  - Standardizzare error handling across API
  - Migliorare test coverage unit e integration

  ---
  CONCLUSIONI

  OpÃ¨ro Ã¨ un sistema ERP completo e ben architettato, ideale per PMI che necessitano di gestione aziendale integrata con:

  âœ… Multi-tenancy robusto per gestione multi-ditta
  âœ… Sicurezza enterprise con permessi granulari
  âœ… ModularitÃ  scalabile con architettura moderna

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
>Â 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ? for shortcuts

  Versione: 1.0
  Autore: Claude Code Assistant

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
>Â 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ? for shortcuts                                                                                                                                                                              Auto-updatingâ€¦


  - Stack: Node.js + Express (backend) + React.js (frontend) + MySQL + Capacitor
  - Pattern: Multi-tenancy avanzato con isolamento completo dati tra ditte
  - Sicurezza: JWT + permission-based authorization granulare (livelli 1-100)

  ğŸ“Š Database Schema

  - 87+ tabelle strutturate per moduli business
  - Multi-ditta: Tutte le tabelle hanno id_ditta per isolamento dati
  - Relazioni complete: ContabilitÃ , Magazzino, Vendite, Email, Documentale

  ğŸ”Œ API Endpoints

  - 87+ endpoint RESTful distribuiti in 10 moduli principali
  - Autenticazione centralizzata con controllo permessi granulare
  - Pattern consistente per request/response handling

  âš›ï¸ Componenti Frontend

  - Architettura modulare con lazy loading per performance
  - 11 moduli business principali con componenti specializzati
  - Sistema permessi integrato con role-based access control

  ğŸ”§ Caratteristiche Enterprise

  - Sistema Email completo con tracking allegati e download
  - Gestione documentale con tracciamento accessi
  - ContabilitÃ  integrata con piano dei conti e prima nota
  - Mobile-ready tramite Capacitor per app native

  Il documento operativo copre:
  - Schema database completo con relazioni
  - API endpoints dettagliati con esempi
  - Componenti frontend e loro interazioni
  - Flussi di lavoro principali
  - Configurazione ambiente e best practices
  - Troubleshooting e manutenzione

  Il sistema Ã¨ ben progettato per essere scalabile, sicuro e manutenibile, ideale per PMI che necessitano di una soluzione ERP completa.